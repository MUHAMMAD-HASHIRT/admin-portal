<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academus Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body class="light-theme">
    <div class="overlay-backdrop" id="mobile-backdrop" onclick="Mobile.toggleMenu()"></div>

    <div id="app-login">
        <div class="login-box">
            <div class="login-icon-wrap"><i class="fas fa-school fa-3x"></i></div>
            <h2 style="margin:10px 0; color:var(--primary);">ACADEMUS</h2>
            <p style="color:var(--text-secondary); margin-bottom:30px;">Portal Access</p>
            <form id="loginForm">
                <input type="text" id="username" placeholder="User ID" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit" class="btn btn-primary btn-block" id="login-btn" style="padding:12px;">Login</button>
            </form>
        </div>
    </div>

    <div id="app-dashboard" style="display:none;">
        <nav class="navbar">
            <button class="mobile-menu-btn" onclick="Mobile.toggleMenu()"><i class="fas fa-bars"></i></button>
            <div style="font-weight:700; font-size:18px; color:var(--primary);"><i class="fas fa-graduation-cap" style="color:var(--accent);margin-right:8px;"></i> Academus</div>
            <div style="display:flex; align-items:center; gap:20px;">
                <button onclick="Theme.toggle()" style="background:none; border:none; cursor:pointer; color:var(--text-secondary);"><i id="theme-icon" class="fas fa-moon"></i></button>
                <div style="text-align:right; font-size:13px;">
                    <div id="userDisplay" style="font-weight:600;">User</div>
                    <div id="roleDisplay" style="color:var(--text-secondary); font-size:11px; text-transform:uppercase;">Role</div>
                </div>
                <button onclick="Auth.logout()" class="btn btn-sm btn-danger"><i class="fas fa-power-off"></i></button>
            </div>
        </nav>

        <div class="sidebar" id="app-sidebar">
            <div class="sidebar-header">Menu</div>
            <ul class="nav-menu">
                <div id="adminNav" class="hidden">
                    <div class="nav-category">Administration</div>
                    <li class="nav-item active" onclick="UI.show('admin-dashboard')"><i class="fas fa-chart-pie" style="width:20px;"></i> Dashboard</li>
                    <li class="nav-item" onclick="UI.show('admin-classes')"><i class="fas fa-sitemap" style="width:20px;"></i> Grades & Subjects</li>
                    <li class="nav-item" onclick="UI.show('admin-students')"><i class="fas fa-user-graduate" style="width:20px;"></i> Students</li>
                    <li class="nav-item" onclick="UI.show('admin-teachers')"><i class="fas fa-chalkboard-teacher" style="width:20px;"></i> Teachers & Staff</li>
                    <li class="nav-item" onclick="UI.show('admin-template')"><i class="fas fa-file-alt" style="width:20px;"></i> Report Template</li>
                </div>
                <div id="teacherNav" class="hidden">
                    <div class="nav-category">Faculty</div>
                    <li class="nav-item active" onclick="UI.show('teacher-dashboard')"><i class="fas fa-book-open" style="width:20px;"></i> My Classes</li>
                </div>
            </ul>
        </div>

        <div class="main-content">
            
            <div id="view-admin-dashboard" class="page-section hidden">
                <div class="card">
                    <h3>Running Session Status</h3>
                    <table class="data-table">
                        <thead><tr><th>Roll</th><th>Student Name</th><th>Grade/Section</th><th>Status</th><th>Actions</th></tr></thead>
                        <tbody id="admin-status-table"></tbody>
                    </table>
                </div>
            </div>

            <div id="view-admin-classes" class="page-section hidden">
                <div style="display:flex; gap:20px; align-items:flex-start;">
                    <div style="flex:2;">
                        <div class="card">
                            <h3>Academic Structure</h3>
                            <div id="class-hierarchy-view"></div>
                        </div>
                    </div>
                    <div style="flex:1;">
                        <div class="card">
                            <h3>Create Grade Level</h3>
                            <input type="text" id="new-class-name" placeholder="e.g., GRADE 1">
                            <button onclick="Admin.addClass()" class="btn btn-primary btn-block">Add Grade</button>
                        </div>
                        <div class="card">
                            <h3>Add Subject to Grade</h3>
                            <select id="subject-class-select"></select>
                            <input type="text" id="new-subject-name" placeholder="Subject Name (e.g., ENGLISH)">
                            <button onclick="Admin.addSubject()" class="btn btn-accent btn-block">Add Subject</button>
                        </div>
                    </div>
                </div>
            </div>

             <div id="view-admin-students" class="page-section hidden">
                 <div class="card">
                     <h3>Student Registration</h3>
                     <div class="form-grid">
                         <input type="text" id="stu-roll" placeholder="Roll Number (Unique)">
                         <input type="text" id="stu-name" placeholder="Full Name">
                         <select id="stu-class-select" onchange="Admin.onStudentClassChange()"></select>
                         <select id="stu-section-select"><option value="">Section</option></select>
                         <input type="text" id="stu-p1" placeholder="Father/Guardian 1">
                         <input type="text" id="stu-p2" placeholder="Mother/Guardian 2">
                         <select id="stu-gender"><option value="M">Male</option><option value="F">Female</option></select>
                         <div style="display:flex; gap:10px;">
                             <input type="number" id="stu-age-y" placeholder="Age Years">
                             <input type="number" id="stu-age-m" placeholder="Age Months">
                         </div>
                         <div style="display:flex; gap:10px;">
                             <input type="number" id="stu-height" placeholder="Height (cm)">
                             <input type="number" id="stu-weight" placeholder="Weight (kg)">
                         </div>
                         <div style="display:flex; gap:10px;">
                             <input type="number" id="stu-att-p" placeholder="Attendance Present">
                             <input type="number" id="stu-att-a" placeholder="Attendance Absent">
                         </div>
                         <select id="stu-pt1"><option>PTC 1 Attended?</option><option>Yes</option><option>No</option></select>
                         <select id="stu-pt2"><option>PTC 2 Attended?</option><option>Yes</option><option>No</option></select>
                     </div>
                     <button onclick="Admin.addStudent()" class="btn btn-primary">Register Student</button>
                     <hr style="margin:20px 0; border-color:var(--glass-border);">
                     <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h4 style="margin:0;">Bulk Import (CSV)</h4>
                        <div><input type="file" id="csv-upload" accept=".csv" style="display:inline-block; width:auto;"><button onclick="Admin.importCSV()" class="btn btn-sm btn-accent">Import</button></div>
                     </div>
                 </div>
                 <div class="card">
                     <h3>Registered Students</h3>
                     <table class="data-table">
                         <thead><tr><th>Roll</th><th>Name</th><th>Class</th><th>Parent</th><th>Action</th></tr></thead>
                         <tbody id="admin-student-list"></tbody>
                     </table>
                 </div>
             </div>

            <div id="view-admin-teachers" class="page-section hidden">
                <div style="display:flex; gap:20px;">
                    <div style="flex:1;">
                        <div class="card">
                            <h3>Register Staff</h3>
                            <input type="text" id="new-t-name" placeholder="Staff Name">
                            <div style="display:flex; gap:10px;">
                                <input type="text" id="new-t-user" placeholder="UserID" readonly style="background:#eee; cursor:not-allowed;">
                                <button onclick="Admin.generateCreds()" class="btn btn-sm btn-accent" style="height:42px;">Generate</button>
                            </div>
                            <input type="text" id="new-t-pass" placeholder="Password">
                            <button onclick="Admin.addTeacher()" class="btn btn-primary btn-block">Create User</button>
                        </div>
                        <div class="card">
                            <h3>Staff Directory</h3>
                            <table class="data-table"><thead><tr><th>Name</th><th>ID</th><th>Pass</th><th>Del</th></tr></thead><tbody id="teacher-list-body"></tbody></table>
                        </div>
                    </div>
                    <div style="flex:1.5;">
                         <div class="card" style="border: 2px solid var(--accent); background: rgba(37, 99, 235, 0.03);">
                            <h3>Assign Roles</h3>
                            <div style="background: #fff; padding: 15px; border-radius: 8px; border: 1px solid var(--glass-border); margin-bottom: 15px;">
                                <div style="font-weight: 600; margin-bottom: 10px; color: var(--accent);">Step 1: Who & Where?</div>
                                <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                                    <select id="assign-teacher-select"><option value="">Select Teacher</option></select>
                                    <select id="assign-class-select" onchange="Admin.onAssignClassChange()"><option value="">Select Grade</option></select>
                                    <select id="assign-section-select"><option value="">Select Section</option></select>
                                </div>
                            </div>

                            <div style="background: #fff; padding: 15px; border-radius: 8px; border: 1px solid var(--glass-border);">
                                <div style="font-weight: 600; margin-bottom: 10px; color: var(--accent);">Step 2: What Role?</div>
                                <div style="display: flex; gap: 20px; align-items: flex-start;">
                                    <div style="flex: 1; padding: 10px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                        <label style="display: flex; align-items: center; gap: 8px; font-weight: 700; cursor: pointer;">
                                            <input type="radio" name="assign-role-type" id="assign-is-ct" style="width: auto; margin: 0;" checked>
                                            Option A: Class Teacher
                                        </label>
                                    </div>
                                    <div style="flex: 1; padding: 10px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                        <label style="display: flex; align-items: center; gap: 8px; font-weight: 700; cursor: pointer;">
                                            <input type="radio" name="assign-role-type" id="assign-is-sub" style="width: auto; margin: 0;">
                                            Option B: Subject Teacher
                                        </label>
                                        <select id="assign-subject-select" style="margin-top: 8px; margin-left: 24px; width: calc(100% - 24px);"><option value="">Select Subject</option></select>
                                    </div>
                                </div>
                                <button onclick="Admin.assignTeacher()" class="btn btn-success btn-block" style="margin-top: 15px; font-size: 14px;">CONFIRM ASSIGNMENT</button>
                            </div>
                        </div>

                        <div class="card">
                            <h3>Class Teachers (Section Managers)</h3>
                            <table class="data-table"><thead><tr><th>Grade</th><th>Sec</th><th>Class Teacher</th><th>Action</th></tr></thead><tbody id="class-teacher-list"></tbody></table>
                        </div>
                        <div class="card">
                            <h3>Subject Assignments</h3>
                            <table class="data-table"><thead><tr><th>Grade</th><th>Sec</th><th>Subject</th><th>Teacher</th><th>Action</th></tr></thead><tbody id="assignment-list-table"></tbody></table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-admin-template" class="page-section hidden" style="height: calc(100vh - 150px);">
                <div class="template-container">
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding-right:10px;">
                        <div style="display:flex; gap:5px; margin-top:5px;">
                            <button id="tab-btn-subject" class="btn btn-primary" style="flex:1; font-size:11px;" onclick="Template.switchView('subject')"><i class="fas fa-table"></i> Subjects</button>
                            <button id="tab-btn-reflection" class="btn btn-accent" style="flex:1; font-size:11px;" onclick="Template.switchView('reflection')"><i class="fas fa-brain"></i> Reflection</button>
                            <button id="tab-btn-lastpage" class="btn btn-accent" style="flex:1; font-size:11px;" onclick="Template.switchView('lastpage')"><i class="fas fa-signature"></i> Signatures</button>
                        </div>

                        <div id="tpl-subject-editor">
                            <div class="card" id="tpl-subject-selector-card" style="margin-bottom:15px; padding-bottom:15px;">
                                <h3 style="margin-bottom:10px;">Select Subject Configuration</h3>
                                <div style="display:flex; gap:10px;">
                                    <select id="tpl-class-select" onchange="Template.onClassChange()" style="margin:0;"></select>
                                    <select id="tpl-subject-select" style="margin:0;"></select>
                                    <button onclick="Template.load()" class="btn btn-accent">Load Details</button>
                                </div>
                            </div>
                            <div class="card">
                                <h3>Report Headers & Settings</h3>
                                <input type="text" id="tpl-title" placeholder="Main Title" oninput="Template.liveUpdate()">
                                <input type="text" id="tpl-sub" placeholder="Sub Title" oninput="Template.liveUpdate()">
                                <textarea id="tpl-desc" placeholder="Description / Letter to parents..." style="height:80px;" oninput="Template.liveUpdate()"></textarea>
                                <div style="display:flex; gap:20px; margin-top:10px;">
                                    <label style="display:flex;align-items:center;gap:5px;font-size:13px;font-weight:600;"><input type="checkbox" id="tpl-show-quant" onchange="Template.liveUpdate()" style="width:auto;margin:0;"> Show Quantitative Table</label>
                                    <label style="display:flex;align-items:center;gap:5px;font-size:13px;font-weight:600;"><input type="checkbox" id="tpl-show-remarks" onchange="Template.liveUpdate()" style="width:auto;margin:0;"> Show Remarks Box</label>
                                </div>
                            </div>
                            <div class="card">
                                <h3>Evaluation Criteria</h3>
                                <div id="template-rows"></div>
                                <div style="display:flex; gap:5px; margin-top:15px;">
                                    <button onclick="Template.add('header')" class="btn btn-sm btn-accent">+ Header</button>
                                    <button onclick="Template.add('item')" class="btn btn-sm btn-primary">+ Criteria Item</button>
                                    <button onclick="Template.add('break')" class="btn btn-sm" style="background:#64748b; color:white;">+ Page Break</button>
                                </div>
                            </div>
                            <div class="card">
                                <h3>Quantitative Totals</h3>
                                <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr 1fr;">
                                    <input type="number" id="qt-1" placeholder="T1 Max">
                                    <input type="number" id="qt-2" placeholder="T2 Max">
                                    <input type="number" id="qt-3" placeholder="Mid Max">
                                    <input type="number" id="qt-4" placeholder="Final Max">
                                </div>
                            </div>
                            <button onclick="Template.save()" class="btn btn-success btn-block" style="height:50px; font-size:16px;">SAVE SUBJECT TEMPLATE</button>
                        </div>

                        <div id="tpl-reflection-editor" class="hidden">
                            <div class="card" style="border: 2px solid var(--accent);">
                                <h3>Self Reflection Page (Global)</h3>
                                <h4>Table 1: My Learning Evaluation</h4>
                                <div id="ref-eval-list"></div>
                                <button onclick="Template.addRefRow('eval')" class="btn btn-sm btn-accent" style="margin-bottom:20px;">+ Add Question</button>
                                <h4>Table 2: My Voice</h4>
                                <div id="ref-voice-list"></div>
                                <button onclick="Template.addRefRow('voice')" class="btn btn-sm btn-accent">+ Add Question</button>
                            </div>
                            <button onclick="Template.syncGlobalsToDB()" class="btn btn-success btn-block" style="height:50px; font-size:16px;">SAVE GLOBAL REFLECTION</button>
                        </div>

                        <div id="tpl-lastpage-editor" class="hidden">
                            <div class="card" style="border: 2px solid var(--accent);">
                                <h3>Last Page Signatures (Global)</h3>
                                <div id="signature-config-list"></div>
                                 <button onclick="Template.addSignatureSlot()" class="btn btn-sm btn-accent" style="margin-top:10px;">+ Add Signature Slot</button>
                            </div>
                            <button onclick="Template.syncGlobalsToDB()" class="btn btn-success btn-block" style="height:50px; font-size:16px;">SAVE GLOBAL SIGNATURES</button>
                        </div>
                    </div>

                    <div style="flex: 1.2; position: relative; border-left: var(--glass-border); padding-left:15px;">
                        <div class="preview-label" id="preview-title-label">LIVE PREVIEW</div>
                        <div class="zoom-controls">
                            <button onclick="Template.zoom(-0.1)" class="btn btn-sm">-</button>
                            <div class="zoom-val" id="zoom-label">42%</div>
                            <button onclick="Template.zoom(0.1)" class="btn btn-sm">+</button>
                        </div>
                        <div id="preview-wrapper">
                            <div id="editor-preview" class="report-page"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-teacher-dashboard" class="page-section hidden">
                <div style="display:flex; gap:20px;">
                    <div style="flex: 2;">
                        <div id="class-teacher-section" class="card hidden" style="border-top: 4px solid var(--accent);">
                            <h3><i class="fas fa-star" style="color:gold; margin-right:5px;"></i> Class Teacher Tasks</h3>
                            <div style="display:flex; gap:20px;">
                                <div style="flex:1;">
                                    <select id="ct-class-select" onchange="Teacher.loadCTStudents()"></select>
                                    <h4 style="margin-bottom:5px;">Class Photograph</h4>
                                    <div style="display:flex; gap:5px; align-items:center; margin-bottom:10px;">
                                        <input type="file" id="ct-photo-upload" accept="image/*" style="width:auto;">
                                        <button onclick="Teacher.uploadPhoto()" class="btn btn-sm btn-primary">Upload</button>
                                    </div>
                                    <div id="ct-photo-preview" style="border:1px solid #ccc; padding:5px; text-align:center; min-height:100px; display:flex; align-items:center; justify-content:center; background:#f9f9f9;">Select Section</div>
                                </div>
                                <div style="flex:1; border-left:1px solid #eee; padding-left:20px;">
                                    <h4 style="margin-bottom:5px;">My Personal Signature</h4>
                                    <div style="display:flex; gap:5px; align-items:center; margin-bottom:10px;">
                                        <input type="file" id="ct-sig-upload" accept="image/*" style="width:auto;">
                                        <button onclick="Teacher.uploadSignature()" class="btn btn-sm btn-accent">Save Signature</button>
                                    </div>
                                    <div id="ct-sig-preview" style="border:1px dashed #ccc; padding:5px; text-align:center; height:60px; display:flex; align-items:center; justify-content:center; background:#f9f9f9;">No signature uploaded.</div>
                                </div>
                            </div>
                            <h4 style="margin-top:20px;">General Remarks (Last Page)</h4>
                            <div style="max-height: 400px; overflow-y: auto;">
                                <table class="data-table">
                                    <thead><tr><th style="width:80px;">Roll</th><th style="width:150px;">Name</th><th>Final Note / Remark</th></tr></thead>
                                    <tbody id="ct-student-list"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="card">
                            <h3>Subject Evaluation</h3>
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                                <select id="teacher-subject-select" style="margin-bottom:0; width:auto; min-width:250px;"></select>
                                <button onclick="Teacher.loadStudents()" class="btn btn-primary">Load Class list</button>
                            </div>
                            <table class="data-table">
                                <thead><tr><th>Roll</th><th>Name</th><th>Status</th><th>Action</th></tr></thead>
                                <tbody id="teacher-student-list"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-evaluation" class="page-section hidden">
                <button onclick="UI.show('teacher-dashboard')" class="btn btn-sm">< Back to Dashboard</button>
                <div class="card" style="margin-top:15px; display:flex; justify-content:space-between; align-items:center; background:#fff8e1; border:1px solid #ffe0b2;">
                    <h3 style="margin:0; border:none; padding:0;">Evaluating: <span id="eval-student-name" style="color:var(--accent);"></span></h3>
                    <button onclick="Teacher.saveReport()" class="btn btn-success">SAVE REPORT DATA</button>
                </div>
                <div style="display:flex; justify-content:center; background:#cbd5e1; padding:30px; border-radius:12px; overflow:auto;">
                    <div id="teacher-workspace" class="report-page" style="transform: scale(0.9); transform-origin: top center; box-shadow: 0 20px 40px rgba(0,0,0,0.3);"></div>
                </div>
             </div>

        </div> </div> <script src="app.js"></script>
</body>
</html>
